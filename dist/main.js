(()=>{"use strict";const e=(e,t)=>{return{length:(r=e,r<1?1:r>5?5:r),name:t,hits:[],hit(e){this.hits.every((t=>t.toString()!==e))&&this.hits.push(e)},isSunk(){return this.hits.length===this.length}};var r};let t=10;function r(e,r){let i=document.createElement("div");i.setAttribute("id",e.toString()),i.classList.add("gameboard-div"),r.appendChild(i);for(let e=1;e<=t;e++)for(let r=1;r<=t;r++){let t=document.createElement("div");t.classList.add("gameboard-tile"),t.setAttribute("data-value",[r,e]),i.appendChild(t)}return i}function i(e,t,r,i){let a=document.createElement(t);return a.classList.add(e),a.textContent=i,r.appendChild(a),a}function a(e,r,i,a,s){if(0==e){let e=r+(a.length-1)>t?11-r:a.length;for(let t=0;t<e;t++){let e=document.querySelector(`[data-value="${r+t},${i}"]`);"add"===s?e.classList.add("hover"):"remove"===s&&e.classList.remove("hover")}return}let n=i+(a.length-1)>t?11-i:a.length;for(let e=0;e<n;e++){let t=document.querySelector(`[data-value="${r},${i+e}"]`);"add"===s?t.classList.add("hover"):"remove"===s&&t.classList.remove("hover")}}function s(e,t){let r=!0;return t.forEach((t=>{e.indexOf(t)>-1&&(r=!1)})),r}function n(e,t){this.ship=e,this.position=t}const o=()=>{let e=[];return{gameboard:e,missedShots:[],placeShip(e,t,r){if(!1===function(e,t,r,i){if(r){if(t[1]+(e.length-1)>10||t[1]+(e.length-1)<1)return!1;let r=[];for(let i=0;i<e.length;i++)r.push([t[0],t[1]+i].toString());return s(i,r)}if(t[0]+(e.length-1)>10||t[0]+(e.length-1)<1)return!1;let a=[];for(let r=0;r<e.length;r++)a.push([t[0]+r,t[1]].toString());return s(i,a)}(e,t,r,this.gameboard.map((e=>e.position.toString()))))return!1;if(r){for(let r=0;r<e.length;r++){let i=new n(e,[t[0],t[1]+r]);this.gameboard.push(i)}return!0}for(let r=0;r<e.length;r++){let i=new n(e,[t[0]+r,t[1]]);this.gameboard.push(i)}return!0},recieveAttack(t){let r=this.gameboard.find((e=>e.position.toString()==t.toString())),i=this.gameboard.indexOf(r);if(-1!==i)return e[i].ship.hit(t),e[i].ship.hits;this.recieveMissedHit(t)},recieveMissedHit(e){-1!==this.missedShots.findIndex((t=>t.toString()===e.toString()))||this.missedShots.push(e)},checkAllShipsSunk:()=>e.reduce(((e,t)=>(e.find((e=>e.name===t.ship.name))?t.times++:(t.times=1,e.push(t.ship)),e)),[]).every((e=>!0===e.isSunk())),updateShipPlacement(e=this.gameboard){0!=e.length&&e.forEach((e=>{let t=e.position;document.querySelector(`[data-value="${t[0]},${t[1]}"]`).classList.add("selected")}))}}};function l(e,t){return Math.floor(Math.random()*(t-e+1)+e)}console.log("working");let h=document.querySelector("body"),c={gameStart:!1,createStartGameMenu(e){let t=i("start-menu-div","div",e),a=(i("welcome-text","div",t,"Welcome to Battleships"),i("place-text","div",t));i("place-text-p","p",a,"Place your"),i("place-current","p",a),i("rotate-button","button",t,"Rotate"),r("place-ship-gameboard",t)},createShips(t){t.ships.push(e(5,"Carrier")),t.ships.push(e(4,"Battleship")),t.ships.push(e(3,"Cruiser")),t.ships.push(e(3,"Carrier")),t.ships.push(e(2,"Destroyer"))},enableShipPlacing(e,t=[],i=0,s=!1){let n=document.querySelector(".place-current"),o=document.querySelectorAll(".gameboard-tile"),l=document.querySelector("#place-ship-gameboard"),h=document.querySelector(".start-menu-div"),c=document.querySelector(".rotate-button");for(e.gameboard.updateShipPlacement(),c.addEventListener("click",(()=>{s=0==s})),t.push(e.ships[0]);t.length>0&&i<5;){t.shift();let c=e.ships[i];n.textContent=c.name,o.forEach((n=>{let o=n.getAttribute("data-value");o=o.split(",");let d=parseInt(o[0]),u=parseInt(o[1]);n.addEventListener("mouseover",(()=>{a(s,d,u,c,"add")})),n.addEventListener("mouseout",(()=>{a(s,d,u,c,"remove")})),n.addEventListener("click",(()=>{o=[d,u],1==e.gameboard.placeShip(c,o,s)&&(i+=1,t.push(e.ships[i]),l.remove(),r("place-ship-gameboard",h),this.enableShipPlacing(e,t,i,s))}))}))}5===i&&(this.gameStart=!0)},startGame(){document.querySelector(".start-menu-div").remove()}};c.createStartGameMenu(h);let d={name:"player1",ships:[],gameboard:o(),passAttacks:[],attack(e,t){if(this.checkAlreadyHit(e))return!1;this.passAttacks.push(e),t.recieveAttack(e)},randomAttack(e){let t=l(1,10),r=l(1,10),i=[t,r];for(;this.checkAlreadyHit(i);)t=l(1,10),r=l(1,10),i=[t,r];return this.attack(i,e),l(1,10)},checkAlreadyHit(e){return-1!==this.passAttacks.findIndex((t=>t.toString()===e.toString()))}};c.createShips(d),c.enableShipPlacing(d),async function(){await function(e){const t=e=>{1==c.gameStart?e():setTimeout((r=>t(e)),400)};return new Promise(t)}(),c.startGame()}()})();